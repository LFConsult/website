<!DOCTYPE html>
<html lang="fr">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Calculateur d'heures de cours</title>
    <meta name="description"
        content="Saisissez des plages horaires ainsi qu'un taux horaire pour obtenir le total en euros de vos heures.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h1><a href="https://lfconsult.fr">LF Consult</h1></a></h1>
        <h2>Calculateur d'heures de cours</h2>
        <p>Saisissez des plages horaires ainsi qu'un taux horaire pour obtenir le total en euros de vos heures.</p>

        <div class="input-group mb-3" style="width: 30%;">
            <span class="input-group-text">Votre taux horaire (euros)</span>
            <input type="text" class="form-control" data-bind='value: tauxHoraire, valueUpdate: "afterkeydown"' />
            <span class="input-group-text">€</span>
        </div>

        <table class="table table-striped table-hover table-sm">
            <thead>
                <tr>
                    <th>Début du cours</th>
                    <th>Fin du cours</th>
                    <th style="text-align: center;">Durée (H:m)</th>
                    <th style="text-align: center;">Durée (décimale)</th>
                    <th style="text-align: center;"></th>
                </tr>
            </thead>
            <tbody data-bind='foreach: lignes'>
                <tr>
                    <td>
                        <select
                            data-bind='options: heures, optionsText: "value", optionsCaption: "Heure début", value: heureDebut'>
                        </select>
                        <select
                            data-bind='options: minutes, optionsText: "value", optionsCaption: "Minute début", value: minuteDebut'>
                        </select>
                    </td>
                    <td>
                        <select
                            data-bind='options: heures, optionsText: "value", optionsCaption: "Heure fin", value: heureFin'>
                        </select>
                        <select
                            data-bind='options: minutes, optionsText: "value", optionsCaption: "Minute fin", value: minuteFin'>
                        </select>
                    </td>
                    <td style="text-align: center;">
                        <span data-bind='text: dureeTextuelle'></span>
                    </td>
                    <td style="text-align: center;">
                        <span data-bind='text: dureeDecimaleTextuelle'></span>
                    </td>
                    <td>
                        <a href='#' data-bind='click: $parent.supprimerLigne'><i class="far fa-trash-alt"></i></a>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="5">
                        <button class="btn btn-primary" data-bind='click: ajouterLigne'><i
                                class="fas fa-plus-square"></i> Ajouter plage horaire</button>
                    </td>
                </tr>
            </tfoot>
        </table>

        <table class="table">
            <thead style="text-align: center;">
                <tr>
                    <th>Durée décimale totale</th>
                    <th>Montant total (euros)</th>
                </tr>
            </thead>
            <tbody style="text-align: center; font-size: 3em;">
                <tr>
                    <td>
                        <span data-bind='text: dureeDecimaleTextuelleTotale()'> </span>
                    </td>
                    <td>
                        <span data-bind='text: totalEuros()'></span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js'></script>

    <script>
        // https://stackoverflow.com/questions/2998784/how-to-output-numbers-with-leading-zeros-in-javascript#answer-11187738
        Number.prototype.pad = function (size) {
            var s = String(this);
            while (s.length < (size || 2)) { s = "0" + s; }
            return s;
        }

        var LigneTableau = function () {
            var self = this;
            // Heures
            var heures = [];
            for (var i = 8; i <= 21; i++) {
                heures.push({
                    'value': i.pad()
                });
            }
            self.heures = heures;
            // Minutes
            var minutes = [];
            for (var i = 0; i <= 55; i += 5) {
                minutes.push({
                    'value': i.pad()
                });
            }
            self.minutes = minutes;
            // Début
            self.heureDebut = ko.observable('');
            self.minuteDebut = ko.observable('');
            // Fin
            self.heureFin = ko.observable('');
            self.minuteFin = ko.observable('');
            // Durée (H:m)
            self.dureeTextuelle = ko.pureComputed(function () {
                if (
                    self.heureDebut()
                    && self.minuteDebut()
                    && self.heureFin()
                    && self.minuteFin()
                ) {
                    if (parseInt(self.minuteDebut().value) > parseInt(self.minuteFin().value)) {
                        var heureFinCalcul = parseInt(self.heureFin().value) - 1;
                        var minutesFinCalcul = parseInt(self.minuteFin().value) + 60;
                    } else {
                        var heureFinCalcul = parseInt(self.heureFin().value);
                        var minutesFinCalcul = parseInt(self.minuteFin().value);
                    }
                    self.dureeMinutes(minutesFinCalcul - parseInt(self.minuteDebut().value));
                    self.dureeHeures(heureFinCalcul - parseInt(self.heureDebut().value));
                    return '' + self.dureeHeures() + ':' + self.dureeMinutes();
                } else {
                    return '';
                }
            });
            // Durée heures
            self.dureeHeures = ko.observable('');
            // Durée minute(s)
            self.dureeMinutes = ko.observable('');
            // Durée décimale (8,27)
            self.dureeDecimaleTextuelle = ko.pureComputed(function () {
                if (
                    self.dureeMinutes()
                    || self.dureeHeures()
                ) {
                    var dureeDecimaleMinutes = (self.dureeMinutes() / 60);
                    var dureeDecimaleHeures = self.dureeHeures();
                    self.dureeDecimale(Math.round(((dureeDecimaleHeures + dureeDecimaleMinutes) + Number.EPSILON) * 100) / 100);
                    return self.dureeDecimale();
                }
            });
            // Durée décimale arrondie
            self.dureeDecimale = ko.observable('');
        };

        var Tableau = function () {
            var self = this;
            self.lignes = ko.observableArray([new LigneTableau()]);

            self.dureeDecimaleTextuelleTotale = ko.computed(function () {
                var dureeDecimaleTextuelleTotale = 0;
                $.each(self.lignes(), function () { dureeDecimaleTextuelleTotale += this.dureeDecimale() })
                return dureeDecimaleTextuelleTotale;
            });

            self.tauxHoraire = ko.observable(0);

            self.totalEuros = ko.computed(function () {
                return self.dureeDecimaleTextuelleTotale() ? self.dureeDecimaleTextuelleTotale() * self.tauxHoraire() : 0;
            });

            self.ajouterLigne = function () { self.lignes.push(new LigneTableau()) };
            self.supprimerLigne = function (ligne) { self.lignes.remove(ligne) };
        };

        ko.applyBindings(new Tableau());
    </script>
</body>

</html>